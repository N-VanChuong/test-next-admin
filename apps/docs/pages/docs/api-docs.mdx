import { Callout, Tabs } from "nextra/components";
import OptionsTable from "../../components/OptionsTable";


# API

<Callout type="info">
  This is the documentation for the latest version of Next Admin. If you are using an older version (`<5.0.0`), please refer to the [documentation](/v4/docs/api-docs)
</Callout>

## `getNextAdminProps` function

<Tabs items={['App router', 'Page router']}>
  <Tabs.Tab>
    The following is used only for App router.

    `getNextAdminProps` is a function that returns the props for the [`NextAdmin`](#nextadmin--component) component. It accepts one argument which is an object with the following properties:

    <OptionsTable
          options={[
            {
              name: 'params',
              description: <> The array of route params retrieved from the <a href="https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes#optional-catch-all-segments">optional catch-all segment</a></>
            },
            {
              name: 'searchParams',
              description: <> The query params <a href="https://nextjs.org/docs/app/api-reference/file-conventions/page#searchparams-optional">retrieved from the page</a></>
            },
            {
              name: 'basePath',
              description: 'The base path of your admin. It is used to build the admin URL. It is mandatory.'
            },
            {
              name: 'apiBasePath',
              description: 'The base path of your admin API. It is used to build the admin API URL. It is mandatory.'
            },
            {
              name: 'schema',
              description: <>The JSON schema generated by the <code>prisma generate</code> command.</>
            },
            {
              name: 'prisma',
              description: 'Your Prisma client instance.'
            },
            {
              name: 'getMessages',
              description: <>A function with no parameters that returns translation messages. It is used to translate the default messages of the library. See <a href="/docs/i18n">i18n</a> for more details.</>
            },
            {
              name: 'locale',
              description: <>The locale used, find from params (e.g. <code>en</code>, <code>fr</code>).</>
            },
            {
              name: 'options',
              description: <>The <a href="#nextadmin-options">options</a> object - optional.</>
            }
      ]}
    />

  </Tabs.Tab>
  <Tabs.Tab>
    The following is used only for Page router

    `getNextAdminProps` is a function that returns the props for the [`NextAdmin`](#nextadmin--component) component. It accepts one argument which is an object with the following properties:

    <OptionsTable
      labels={{
        option: 'Name',
          }}
      
      options={[
        {
          name: 'basePath',
          description: <>The base path of your admin. It is used to build the admin URL. It is optional and defaults to <code>/admin</code>.</>
        },
        {
          name: 'apiBasePath',
          description: <>The base path of your admin API. It is used to build the admin API URL. It is optional and defaults to <code>/api/admin</code>.</>
        },
        {
          name: 'schema',
          description: <>The JSON schema generated by the <code>prisma generate</code> command.</>
        },
        {
          name: 'prisma',
          description: 'Your Prisma client instance.'
        },
        {
          name: 'req',
          description: <>The request object from the page (<code>IncomingMessage</code>). </>
        },
        {
          name: 'getMessages',
          description: <>A function with no parameters that returns translation messages. It is used to translate the default messages of the library. See <a href="/docs/i18n">i18n</a> for more details.</>
        },
        {
          name: 'locale',
          description: <>The locale used, find from params (e.g. <code>en</code>, <code>fr</code>).</>
        },
        {
          name: 'options',
          description: <>The <a href="#nextadmin-options">options</a> object - optional.</>
        }
        
      ]}
      />
  </Tabs.Tab>
</Tabs>

## `createHandler` function

`createHandler` is a function that returns an object that allow you to catch all API access. It accepts an object with the following properties:

<OptionsTable
  options={[
    {
      name: 'prisma',
      description: 'Your Prisma client instance. This is mandatory'
    },
    {
      name: 'schema',
      description: 'Your JSON Schema generated by Prisma. This is mandatory.'
    },
    {
      name: 'onRequest',
      description: 'A function that is executed before any request. Useful for authentication.'
    },
    {
      name: 'options',
      description: 'Your Next-Admin options'
    }
  ]}
/>

## `<NextAdmin />` component

`<NextAdmin />` is a React component that contains the entire UI of Next Admin. It can take several props from `getNextAdminProps` function, but also some additional props:

- `options` used to customize the UI, like field formatters for example. Do not use with App router.
- `dashboard` used to customize the rendered dashboard
- `user` used to add some user information at the bottom of the menu. See [user properties](#user-properties) for more details.

This is an example of using the `NextAdmin` component with a custom Dashboard component and options:

```tsx
// pages/admin/[[...nextadmin]]/page.tsx
import Dashboard from "../../components/CustomDashboard";

export default function Admin(props: AdminComponentProps) {
  /* Props are passed from getNextAdminProps function */
  return (
    <NextAdmin
      {...props}
      dashboard={Dashboard}
      user={{
        data: {
          name: "John Doe",
        },
        logoutUrl: "/api/auth/logout",
      }}
    />
  );
}
```

## Next Admin Options

### `title`

The `title` property is a string that represents the title of the admin dashboard. It is displayed in the sidebar. By default, it is set to "Admin".

### `model`

`model` is an object that represents the customization options for each model in your schema.

It takes as **_key_** a model name of your schema as **_value_** an object to customize your it.

By default if no models are defined, they will all be displayed in the admin. If you want more control, you have to define each model individually as empty objects or with the following properties:

<OptionsTable
      options={[
        {
          name: "toString",
          description: "a function that is used to display your record in related list",
          defaultValue: "id field",
        },
        {
          name: "aliases",
          description: "an object containing the aliases of the model fields as keys, and the field name"
        },
        {
          name: "title",
          description: "a string used to display the model name in the sidebar and in the section title",
          defaultValue: "Model name",
        },
        {
          name: "list",
          description: <>an object containing the list options (see <a href="#list-property">list property</a>)</>
        },
        {
          name: "edit",
          description: <>an object containing the edit options (see <a href="#edit-property">edit property</a>)</>
        },
        {
          name: "actions",
          description: <> an array of actions (see <a href="#actions-property">actions property</a>)</>
        },
        {
          name: "icon",
          description: <>the outline <a href="https://heroicons.com/" target="_blank">HeroIcon</a> name displayed in the sidebar and pages title</>,
        },
        {
          name: "permissions",
          description: "an array to specify restricted permissions on model",
          defaultValue: "[`create`, `edit`, `delete`]"
        },
  ]} />

You can customize the following for each model:

- ##### `list` property

This property determines how your data is displayed in the [List View](/docs/glossary#list-view)
<OptionsTable 
  options={[
    {
      name: "search",
      type: "Array",
      description: "an array of searchable fields",
      defaultValue: 'All scalar fields are searchable by default',
    },
    {
      name: "display",
      type: "Array",
      description: "an array of fields that are displayed in the list",
      defaultValue: 'All scalar fields are displayed by default',
    },
    {
      name: "fields",
      type: "Object",
      description: <>an object containing the model fields as keys, and customization values (see <a href="#editfields--listfields-property">fields property</a>)</>,
    },
    {
      name: "copy",
      type: "Array",
      description: "an array of fields that are copyable into the clipboard",
      defaultValue: "undefined - no field is copyable by default",
    },
    {
      name: "defaultSort",
      type: "Object",
      description: "an optional object to determine the default sort to apply on the list",
    },
    {
      name: "defaultSort.field",
      type: "String",
      description: "the model's field name on which the sort is applied. It is mandatory",
    },
    {
      name: "defaultSort.direction",
      type: "String",
      description: "the sort direction to apply. It is optional",
    },
    {
      name: "filters",
      type: "Array",
      description: <> define a set of Prisma filters that user can choose in list (see <a href="#listfilters-property">filters</a>)</>,
    },
    {
      name: "exports",
      type: "Object",
      description: <>an object or array of export - containing export url (see <a href="#listexports-property">exports</a>)</>,
    },
  ]}
/>
<Callout type="info">
  The `search` property is only available for [`scalar` fields](https://www.prisma.io/docs/orm/reference/prisma-schema-reference#model-field-scalar-types).
</Callout>

- ##### `edit` property

This property determines how your data is displayed in the [edit view](/docs/glossary#edit-view)
  <OptionsTable
        options={[
    {
      name: "display",
      type: "Array",
            description: <> an array of fields that are displayed in the form. It can also be an object that will be displayed in the form of a notice (see <a href="#notice-type">notice</a>)</>,
      defaultValue: "all scalar fields are displayed",
    },
    {
      name: "styles",
      type: "Object",
      description: <>an object containing the styles of the form (see <a href="#editstyles-property">styles</a>) </>,
    },
    {
      name: "fields",
      type: "Object",
      description: <>an object containing the model fields as keys, and customization values (see <a href="#editfields--listfields-property">fields property</a>)</>,
    },
    {
      name: "submissionErrorMessage",
      type: "String",
      description: "a message displayed if an error occurs during the form submission",
      defaultValue: "'Submission error'",
    },
  ]}
  />

##### `styles` property

The `styles` property is available in the `edit` property.
<Callout emoji="⚠️">
  If your options are defined in a separate file, make sure to add the path to the `content` property of the `tailwind.config.js` file (see [TailwindCSS configuration](/docs/getting-started#tailwindcss-configuration)).
</Callout>

<OptionsTable 
  options={[
    {
      name: "_form",
      type: "String",
      description: "a string defining the classname of the form",
    },
    {
      name: "...",
      type: "String",
      description: "all fields of the model, with the field name as key and the classname as value",
    },
  ]}
/>

Here is an example of using `styles` property:

```ts
styles: {
  _form: "form-classname",
  ... // all fields
};
```

##### `fields` property

The `fields` property is available in both `list` and `edit` properties.

For the `list` property, it can take the following:


<OptionsTable
  options={[
        {
          name: "formatter",
          type: "Function",
          description: <>a function that takes the field value as a parameter, and that return a JSX node. It also accepts a second argument which is the <a href="#nextadmin-context-type">NextAdmin context</a></>,
        },
        {
          name: "sortBy",
          type: "String",
          description: "available only on many-to-one models. The name of a field of the related model to apply the sort on. Defaults to the id field of the related model",
        },
  ]}
/>

For the `edit` property, it can take the following:

<OptionsTable
      options={[
        {
          name: "validate",
          type: "Function",
          description: "a function that takes the field value as a parameter, and that returns a boolean",
        },
        {
          name: "format",
          type: "String",
          description: <>a string defining an OpenAPI field format, overriding the one set in the generator. An extra <code>file</code> format can be used to be able to have a file input</>,
        },
        {
          name: "input",
          type: "React Element",
          description: <>a React Element that should receive <a href="#custominputprops-type">CustomInputProps</a>. For App Router, this element must be a client component</>,
        },
        {
          name: "handler",
          type: "Object",
          description: "",
        },
        {
          name: "handler.get",
          type: "Function",
          description: "a function that takes the field value as a parameter and returns a transformed value displayed in the form",
        },
        {
          name: "handler.upload",
          type: "Function",
          description: <>an async function that is used only for formats <code>file</code> and <code>data-url</code>. It takes a Buffer object and an information object containing <code>name</code> and <code>type</code> property as parameters and must return a string. Useful to upload a file to a remote provider</>,
        },
        {
          name: "handler.uploadErrorMessage",
          type: "String",
          description: "an optional string displayed in the input field as an error message in case of a failure during the upload handler",
        },
        {
          name: "optionFormatter",
          type: "Function",
          description: "only for relation fields, a function that takes the field values as a parameter and returns a string. Useful to display your record in related list",
        },
        {
          name: "tooltip",
          type: "String",
          description: "A tooltip content to display for the field ",
        },
        {
          name: "helperText",
          type: "String",
          description: "a helper text that is displayed underneath the input",
        },
        {
          name: "disabled",
          type: "Boolean",
          description: "a boolean to indicate that the field is read only",
        },
        {
          name: "display",
          type: "String",
          description: <> only for relation fields, indicate which display format to use between <code>list</code>, <code>table</code> or <code>select</code></>, 
          defaultValue: "select",
        },
        {
          name: "required",
          type: "Boolean",
          description: <>a true value to force a field to be required in the form, note that if the field is required by the Prisma schema, you cannot set <code>required</code> to false</>,
        },
        {
          name: "relationOptionFormatter",
          type: "Function",
          description: <>same as <code>optionFormatter</code>, but used to format data that comes from an <a href="https://www.prisma.io/docs/orm/prisma-schema/data-model/relations/many-to-many-relations#explicit-many-to-many-relations">explicit many-to-many</a> relationship</>,
            },
        {
          name: "orderField",
          type: "String",
          description: <>the field to use for relationship sorting. This allow to drag and drop the related records in the <code>list</code> display</>,
        },
        {
          name: "relationshipSearchField",
          type: "String",
          description: <>a field name of the explicit many-to-many relation table to apply the search on. See <a href="https://www.prisma.io/docs/orm/prisma-schema/data-model/relations/many-to-many-relations#explicit-many-to-many-relations">handling explicit many-to-many</a></>,
            },
      ]}
    />

##### `filters` property

The `filters` property allow you to define a set of Prisma filters that user can apply on list page. It's an array of the type below:

<OptionsTable
  options={[
    {
      name: "name",
      type: "String",
      description: "an unique name for the filter",
    },
    {
      name: "active",
      type: "Boolean",
      description: "a boolean to set filter active by default",
      defaultValue: "false",
    },
    {
      name: "value",
      type: "String",
      description: <>a where clause Prisma filter of the related model (e.g <a href="https://www.prisma.io/docs/orm/reference/prisma-client-reference#filter-conditions-and-operators">Prisma operators</a>)</>,
    },
  ]}
/>

##### `exports` property

The `exports` property is available in the `list` property. It's an object or an array of objects that can take the following properties:

<OptionsTable
  options={[
    {
      name: "format",
      type: "String",
      description: "a string defining the format of the export. It's used to labeled the export button",
      defaultValue: "undefined",
    },
    {
      name: "url",
      type: "String",
      description: "a string defining the URL of the export action",
      defaultValue: "undefined",
    },
  ]}
/>

<Callout type="info">
  The `exports` property does not account for active filters. If you want to export filtered data, you need to add the filters to the URL or in your export action.
</Callout>

### `pages`

`pages` is an object that allows you to add your own sub pages as a sidebar menu entry. It is an object where the key is the path (without the base path) and the value is an object with the following properties:

<OptionsTable
      options={[
        {
          name: "title",
          type: "String",
          description: "The title of the page displayed on the sidebar",
        },
        {
          name: "icon",
          type: "String",
          description: <>The <a href="https://heroicons.com/outline">outline HeroIcon name</a> of the page displayed on the sidebar</>,
        },
  ]}
/>

#### `actions` property

The `actions` property is an array of objects that allows you to define a set of actions that can be executed on one or more records of the resource. On the list view, there is a default action for deletion. The object can take the following properties:

<OptionsTable
  options={[
    {
      name: "title",
      type: "String",
      description: "action title that will be shown in the action dropdown",
        },
    {
      name: "id",
      type: "String",
      description: "mandatory action unique identifier",
    },
    {
      name: "action",
      type: "Function",
      description: <>an async function that will be triggered when selecting the action in the dropdown. For App Router, it must be defined as a server action</>,
    },
    {
      name: "successMessage",
      type: "String",
      description: "a message that will be displayed when the action is successful",
    },
    {
      name: "errorMessage",
      type: "String",
      description: "a message that will be displayed when the action fails",
    },
  ]}
/>

#### `sidebar` property

The `sidebar` property allows you to customise the aspect of the sidebar menu. It is an object that can take the following properties:

<OptionsTable
  options={[
    {
      name: "groups",
      type: "Array",
      description: "an array of objects that creates groups for specific resources",
    },
    {
      name: "groups[].title",
      type: "String",
      description: "the name of the group",
    },
    {
      name: "groups[].models",
      type: "Array",
      description: "the model names to display in the group",
    },
  ]}
/>

#### `externalLinks` property

The `externalLinks` property allows you to add external links to the sidebar menu. It is an array of objects that can take the following properties:

<OptionsTable 
  options={[
    {
      name: "label",
      type: "String",
      description: "the label of the link displayed on the sidebar. This is mandatory",
    },
    {
      name: "url",
      type: "String",
      description: "the URL of the link. This is mandatory",
    },
  ]}
/>

### `defaultColorScheme` property

The `defaultColorScheme` property defines a default color palette between `light`, `dark` and `system`, but allows the user to modify it. Default to `system`.

### `forceColorScheme` property

Identical to `defaultColorScheme` but does not allow the user to change it.

Here is an example of using `NextAdminOptions` for the following schema :

```prisma
// prisma/schema.prisma
enum Role {
  USER
  ADMIN
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  password  String   @default("")
  posts     Post[]   @relation("author") // One-to-many relation
  profile   Profile? @relation("profile") // One-to-one relation
  birthDate DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  role      Role     @default(USER)
}
```

```tsx
// pages/api/admin/options.ts
export const options: NextAdminOptions = {
  basePath: "/admin",
  model: {
    User: {
      toString: (user) => `${user.name} (${user.email})`,
      list: {
        display: ["id", "name", "email", "posts", "role", "birthDate"],
        search: ["name", "email"],
        fields: {
          role: {
            formatter: (role) => {
              return <strong>{role.toString()}</strong>;
            },
          },
          birthDate: {
            formatter: (date) => {
              return new Date(date as unknown as string)
                ?.toLocaleString()
                .split(" ")[0];
            },
          },
        },
      },
      edit: {
        display: ["id", "name", "email", "posts", "role", "birthDate"],
        fields: {
          email: {
            validate: (email) => email.includes("@") || "Invalid email",
          },
          birthDate: {
            format: "date",
          },
          avatar: {
            format: "file",
            handler: {
              upload: async (buffer, infos) => {
                return "https://www.gravatar.com/avatar/00000000000000000000000000000000";
              },
            },
          },
        },
      },
    },
  },
};
```

## CustomInputProps

This is the type of the props that are passed to the custom input component:

<OptionsTable
  options={[
    {
      name: "name",
      type: "String",
      description: "the field name",
    },
    {
      name: "value",
      type: "any",
      description: "the field value",
    },
    {
      name: "onChange",
      type: "Function",
      description: <> a function taking a <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/change_event">ChangeEvent</a> as a parameter</>,
    },
    {
      name: "readonly",
      type: "Boolean",
      description: "boolean indicating if the field is editable or not",
    },
    {
      name: "rawErrors",
      type: "Array",
      description: "array of strings containing the field errors",
    },
    {
      name: "disabled",
      type: "Boolean",
      description: "boolean indicating if the field is disabled",
    },
    {
      name: "required",
      type: "Boolean",
      description: "boolean indicating if the field is required",
    },
  ]}
/>


## NextAdmin Context

The `NextAdmin` context is an object containing the following properties:

<OptionsTable
  options={[
    {
      name: "locale",
      type: "String",
      description: <>The locale used by the calling page. (refers to the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language">accept-language</a> header)</>,
    },
    {
      name: "row",
      type: "Object",
      description: "The current row of the list view",
    },
  ]}
/>

## Notice

The edit page's form can display notice alerts. To do so, you can pass objects in the `display` array of the `edit` property of a model. This object takes the following properties :

<OptionsTable
  options={[
    {
      name: "title",
      type: "String",
      description: "The title of the notice. This is mandatory",
    },
    {
      name: "id",
      type: "String",
      description: <>A unique identifier for the notice that can be used to style it with the <code>styles</code> property. This is mandatory</>,
    },
    {
      name: "description",
      type: "String",
      description: "The description of the notice. This is optional",
    },
  ]}
/>

## User properties

The `user` property is an object that can take the following properties:

<OptionsTable
  options={[
    {
      name: "data.name",
      type: "String",
      description: "the name of the user displayed in the sidebar menu. This is required",
    },
    {
      name: "data.picture",
      type: "String",
      description: "the URL of the user's avatar displayed in the sidebar menu",
    },
    {
      name: "logoutUrl",
      type: "[RequestInfo, RequestInit?] | Function (server action)",
      description: <>either a request tuple (<code>[RequestInfo, RequestInit?]</code>) to fetch the logout API or a server action. This is required.</>,
    },
  ]}  
/>